language: ruby
rvm: system
sudo: required
services: docker
os: linux

matrix:
  include:
    - env: OSX=10.11
      os: osx
      osx_image: xcode8
      rvm: system
    - env: OSX=10.11
      os: osx
      osx_image: xcode7.3
      rvm: system
    - env: OSX=10.10
      os: osx
      osx_image: xcode7
      rvm: system

before_install:
  - if [ -f ".git/shallow" ]; then travis_retry git fetch --unshallow; fi
  - sudo chown -R $USER $(brew --repo);
  - brew untap caskroom/cask;
  - brew tap homebrew/science;
  - brew update;
  - mkdir -p $(brew --repo)/Library/Taps/optimizers;
  - ln -s $PWD $(brew --repo)/Library/Taps/optimizers/homebrew-fenics;
  - cd $(brew --repo)/Library/Taps/optimizers/homebrew-fenics;
  - brew tap --repair;
  - export TRAVIS_BUILD_DIR="$(brew --repo)/Library/Taps/optimizers/homebrew-fenics";
  - brew uninstall boost;
  # - .travis_helper/travis.sh brew install boost --without-single --with-mpi;
  - brew install boost --without-single --with-mpi;
  - brew install slepc;
  - sudo -H easy_install pip;
  - sudo -H pip install ply;
  - export PETSC_DIR="$(brew --prefix)/opt/petsc/real";
  - export SLEPC_DIR="$(brew --prefix)/opt/slepc/real";
  - sudo -H -E pip install mpi4py petsc4py slepc4py;
  - brew install sip pyqt
  - brew install vtk
  # - .travis_helper/travis.sh brew install vtk --with-qt;
  - brew install dolfin;
  - brew test dolfin;
  - env | grep TRAVIS | tee /tmp/travis.env

script:
  - brew test-bot --tap=optimizers/fenics;

notifications:
  email: never
